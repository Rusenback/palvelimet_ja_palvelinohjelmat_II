--- 
- name: Install UFW
  apt: 
    name: ufw 
    state: present

- name: Allow SSH through firewall
  ufw: 
    rule: allow
    port: '22'
    proto: tcp
    comment: 'SSH'

- name: Allow Samba ports through firewall
  ufw: 
    rule: allow
    port: "{{ item.port }}"
    proto: "{{ item.proto }}"
    comment: "{{ item.comment }}"
  loop: 
    - { port: '137', proto: 'udp', comment: 'NetBios Name Service' }
    - { port: '138', proto: 'udp', comment: 'NetBios Datagram Service' }
    - { port: '139', proto: 'tcp', comment: 'NetBios Session Service' }
    - { port: '445', proto: 'tcp', comment: 'SMB over TCP' }

- name: Set UFW default policies 
  uwf:
    direction: "{{ item.direction }}"
    policy: "{{ item.policy }}"
  loop:
    - { direction: 'incoming', policy: 'deny' }
    - { direction: 'outgoing', policy: 'allow' }

- name: Enable ufw
  ufw: 
    state: enabled
